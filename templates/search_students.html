<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Students | Student Management & Analytics System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="dashboard-page">

<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2>Student Management & Analytics System</h2>

        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('students_page') }}">View Students</a>
        <a href="{{ url_for('search_students_page') }}" class="active">Search Students</a>

        {% if session.get("role") == "ADMIN" %}
            <a href="{{ url_for('attendance_page') }}">Mark Attendance</a>
            <a href="{{ url_for('add_student_page') }}">Add Student</a>
            <a href="{{ url_for('manage_users') }}">Manage Users</a>
            <a href="{{ url_for('reports_page') }}">Reports</a>
            <a href="{{ url_for('analytics_page') }}">Analytics</a>
        {% endif %}

        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">

        <div class="topbar">
            <h1>Search Students</h1>
        </div>

        <div class="table-card animate">

            <!-- SEARCH -->
            <form method="get" style="margin-bottom:20px;">
                <input type="text" name="q"
                       placeholder="Search by roll or name"
                       value="{{ request.args.get('q','') }}"
                       style="max-width:1037px;">
                <button type="submit">Search</button>
            </form>

            <!-- TABLE -->
            <table>
                <thead>
                    <tr>
                        <th>Roll</th>
                        <th>Photo</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Branch</th>
                        <th>Email</th>
                    </tr>
                </thead>

                <tbody>
                {% if searched %}
                    {% if students %}
                        {% for s in students %}
                        <tr>
                            <td>{{ s[0] }}</td>

                            <td>
                                {% if s[5] %}
                                    <img src="{{ url_for('static', filename='uploads/' + s[5]) }}"
                                         class="student-photo"
                                         onclick="openModal(this.src)">
                                {% else %}
                                    No Photo
                                {% endif %}
                            </td>

                            <td>{{ s[1] }}</td>
                            <td>{{ s[2] }}</td>
                            <td>{{ s[3] }}</td>

                            <td>
                                {% if s[4] %}
                                    {{ s[4] }}
                                {% else %}
                                    Not Added
                                {% endif %}
                            </td>

                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" style="text-align:center;">
                                No results found
                            </td>
                        </tr>
                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="6" style="text-align:center;">
                            Enter roll or name to search
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>

        </div>

    </main>

</div>

<!-- IMAGE POPUP -->
<div id="imgModal" class="img-modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modalImg">
</div>

<script>
function openModal(src) {
    document.getElementById("imgModal").style.display = "block";
    document.getElementById("modalImg").src = src;
}
function closeModal() {
    document.getElementById("imgModal").style.display = "none";
}
</script>

</body>
</html>
